const S=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerpolicy&&(s.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?s.credentials="include":e.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(e){if(e.ep)return;e.ep=!0;const s=t(e);fetch(e.href,s)}};S();let a="",i="";const u=document.querySelector("#signInModal"),d=document.querySelector("#nameForm"),m="wss://maintain.fhsh.tp.edu.tw/api/ws/";window.localStorage.getItem("userToken")&&window.localStorage.getItem("userName")&&(window.localStorage.getItem("userName"),a=window.localStorage.getItem("userToken"),u.classList.add("hidden"),i=new WebSocket(`${m}${a}`),i.onmessage=n=>p(n));d.addEventListener("submit",function(n){n.preventDefault();const o=d.name;window.localStorage.setItem("userName",o.value),window.localStorage.setItem("userToken",window.btoa(`${o.value}-${new Date().getTime()}`)),o.value="",u.classList.add("hidden"),i=new WebSocket(`${m}${window.localStorage.getItem("userToken")}`),i.onmessage=t=>p(t)});const g=document.querySelector("#messageInputer"),l=document.querySelector("#messageBox"),y=document.querySelector("#ConversationFrom"),h=document.querySelector("#ConversationTo");g.addEventListener("submit",function(n){n.preventDefault();const o=g.messageInput;!o.value||(i.send(JSON.stringify({message:o.value})),o.value="")});function f(){l.clientHeight<l.scrollHeight&&l.classList.add("overflow-y-scroll")}function w(n,o,t="me"){const r=n;r.content.querySelector("#message").innerText=o,r.content.querySelector("#name").innerText=t;const e=document.importNode(r.content,!0);l.appendChild(e),f(),l.scrollTo(0,l.scrollHeight)}function k(n,o){const t=document.querySelector("#joinNleave").content;t.querySelector("#name").innerText=n,t.querySelector("#status").innerText=o;const r=document.importNode(t,!0);l.appendChild(r),f(),l.scrollTo(0,l.scrollHeight)}function p(n){JSON.parse(n.data).forEach(t=>{if(t.status){const c=window.atob(t.client_token).split("-")[0];k(c,t.status=="SIGNOUT"?"leave":"join");return}if(t.client_token==window.localStorage.getItem("userToken")){w(h,t.message);return}const e=window.atob(t.client_token).split("-")[0];w(y,t.message,e)})}
